<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Sanctuary</title>
    <!-- GOOGLE FONT -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <!-- BOXICONS -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <!-- APP CSS -->
    <link rel="stylesheet" th:href="@{/css/grid.css}">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/create.css}">
    <script src="https://kit.fontawesome.com/3edce6b09c.js" crossorigin="anonymous"></script>

</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="sidebar-logo">
        <!-- <img src="./images/logo-lg.png" alt="Comapny logo"> -->
        <div class="sidebar-close" id="sidebar-close">
            <i class='bx bx-left-arrow-alt'></i>
        </div>
    </div>
    <div class="sidebar-user">
        <div class="sidebar-user-info">
            <!-- <img src="./images/user-image.jpg" alt="User picture" class="profile-image"> -->
            <div class="sidebar-user-name">
                Admin
            </div>
        </div>
        <button class="btn btn-outline">
            <a th:href="@{/perform_logout}">
                <i class='bx bx-log-out bx-flip-horizontal'></i>
            </a>
        </button>
    </div>
    <!-- SIDEBAR MENU -->
    <ul class="sidebar-menu">
        <li>
            <a th:href="@{/admin}" class="active">
                <i class='bx bx-home'></i>
                <span>dashboard</span>
            </a>
        </li>
        <li>
            <a href="#">
                <i class='bx bx-shopping-bag'></i>
                <span>sales</span>
            </a>
        </li>
        <li>
            <a th:href="@{/admin/orders}">
                <i class='bx bx-chart'></i>
                <span>order history</span>
            </a>
        </li>
        <li class="sidebar-submenu">
            <a href="#" class="sidebar-menu-dropdown">
                <i class='bx bx-user-circle'></i>
                <span>Category</span>
                <div class="dropdown-icon"></div>
            </a>
            <ul class="sidebar-menu sidebar-menu-dropdown-content">
                <li>
                    <a th:href="@{/admin/category}">
                        Categories
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/category/add}">
                        Add Category
                    </a>
                </li>

                <li>
                    <a th:href="@{/admin/category/restore}">
                        Restores Category
                    </a>
                </li>
            </ul>
        </li>
        <li class="sidebar-submenu">
            <a href="#" class="sidebar-menu-dropdown">
                <i class='bx bx-category'></i>
                <span>Item</span>
                <div class="dropdown-icon"></div>
            </a>
            <ul class="sidebar-menu sidebar-menu-dropdown-content">
                <li>
                    <a th:href="@{/admin/item}">
                        Items
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/item/add}">
                        Add Item
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/item/restore}">
                        Restore Item
                    </a>
                </li>
            </ul>
        </li>
        <li class="sidebar-submenu">
            <a href="#" class="sidebar-menu-dropdown">
                <i class='bx bx-category'></i>
                <span>Product</span>
                <div class="dropdown-icon"></div>
            </a>
            <ul class="sidebar-menu sidebar-menu-dropdown-content">
                <li>
                    <a th:href="@{/admin/product}">
                        Products
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/product/add}">
                        Add Product
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/product/restore}">
                        Restore Product
                    </a>
                </li>
            </ul>
        </li>
        <li class="sidebar-submenu">
            <a href="#" class="sidebar-menu-dropdown">
                <i class='bx bx-category'></i>
                <span>e-commerce</span>
                <div class="dropdown-icon"></div>
            </a>
            <ul class="sidebar-menu sidebar-menu-dropdown-content">
                <li>
                    <a href="#">
                        list products
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/product/create}">
                        add product
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/product/restore}">
                        restore
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <a th:href="@{/admin/customer}">
                <i class='bx bx-mail-send'></i>
                <span>customer</span>
            </a>
        </li>
        <li>
            <a href="#">
                <i class='bx bx-chat'></i>
                <span>chat</span>
            </a>
        </li>
        <li>
            <a href="#">
                <i class='bx bx-calendar'></i>
                <span>calendar</span>
            </a>
        </li>
        <li class="sidebar-submenu">
            <a href="#" class="sidebar-menu-dropdown">
                <i class='bx bx-cog'></i>
                <span>settings</span>
                <div class="dropdown-icon"></div>
            </a>
            <ul class="sidebar-menu sidebar-menu-dropdown-content">
                <li>
                    <a href="#" class="darkmode-toggle" id="darkmode-toggle">
                        darkmode
                        <span class="darkmode-switch"></span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
    <!-- END SIDEBAR MENU -->
</div>
<!-- END SIDEBAR -->

<!-- MAIN CONTENT -->
<div class="main">
    <div class="main-header">
        <div class="mobile-toggle" id="mobile-toggle">
            <i class='bx bx-menu-alt-right'></i>
        </div>
        <div class="main-title">
            dashboard
        </div>
    </div>

    <!-- ORDERS TABLE -->
    <div class="box">
        <div class="box-body overflow-scroll">
            <div class="box-header">
                Add Product
            </div>
            <div  class="box-body overflow-scroll">
                <form id="product-form" th:action="@{/admin/product/add}" th:method="post" th:object="${product}">
                    <table>
                        <tr>
                            <th>
                                <label>Name:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{name}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Original Price:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{original_price}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Discount:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{discount}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Description:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{description}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Detail:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{details}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Delivery:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{delivery}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Sub Info:</label>
                            </th>
                            <td>
                                <input type="text" th:field="*{sub_info}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Image 1:</label>
                            </th>
                            <td>
                                <input type="file" th:field="*{image1}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Image 2:</label>
                            </th>
                            <td>
                                <input type="file" th:field="*{image2}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Image 3:</label>
                            </th>
                            <td>
                                <input type="file" th:field="*{image3}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Image 4:</label>
                            </th>
                            <td>
                                <input type="file" th:field="*{image4}">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                <label>Image 5:</label>
                            </th>
                            <td>
                                <input type="file" th:field="*{image5}">
                            </td>
                        </tr>
                        <tr th:each="item : ${items}" th:if="${item.deleted == false}">
                            <th>
                                <label>Item:</label>
                            </th>
                            <td>
                                <select name="itemIDs" id="item" multiple="multiple">
                                    <th:block >
                                        <option th:value="${item.id}" th:text="${item.name}"></option>
                                    </th:block >
                                </select>
                            </td>
                            <th>
                                <label>Quantity:</label>
                            </th>
                            <td>
                                <input type="number" id="number-flower" name="numberFlower">
                            </td>
                        </tr>
                        <tr th:each="category : ${categories}" th:if="${category.deleted == false}">
                            <th>
                                <label>Category:</label>
                            </th>
                            <td>
                                <select name="categoryIDs" multiple="multiple">
                                    <!-- Thêm các option từ danh sách categories -->
                                    <th:block >
                                        <option th:value="${category.id}" th:text="${category.name}"></option>
                                    </th:block>
                                </select>
                            </td>
                        </tr>



                        <!--                        <tr>-->
<!--                            <th>-->
<!--                                <label>Number of Flower Type: </label>-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <input type="number" id="number-type" name="numberType">-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <th>-->
<!--                                <label>Number of Flowers: </label>-->
<!--                            </th>-->
<!--                            <td>-->
<!--                                <input type="number" id="number-flower2" name="numberFlower">-->
<!--                            </td>-->
<!--                        </tr>-->
                        <tr><div id="select-container"></div></tr>
                    </table>
                    <button id="add-button" type="submit">ADD</button>


                </form>
            </div>
        </div>

    </div>
    <!-- END ORDERS TABLE -->

    <!-- END MAIN CONTENT -->

    <div class="overlay"></div>

    <!-- SCRIPT -->
    <!-- APEX CHART -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- APP JS -->
    <script th:src="@{/js/app.js}"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!--    <script>-->
<!--        document.getElementById('product-form').addEventListener('submit', function(event) {-->
<!--            event.preventDefault(); // Ngăn chặn biểu mẫu được submit mặc định-->

<!--            var itemObjects = [];-->
<!--            var selects = document.querySelectorAll('select[name="item"]');-->
<!--            selects.forEach(function(select) {-->
<!--                var selectedItemId = select.value;-->
<!--                var quantityInput = select.closest('tr').querySelector('input[name="numberFlower"]');-->
<!--                var quantityValue = quantityInput.value;-->
<!--                var itemObject = { id: selectedItemId, quantity: quantityValue };-->
<!--                itemObjects.push(itemObject);-->
<!--            });-->

<!--            var categoryIDs = [];-->
<!--            var categorySelect = document.querySelector('select[name="categoryIDs"]');-->
<!--            var selectedCategories = categorySelect.selectedOptions;-->
<!--            selectedCategories.forEach(function(option) {-->
<!--                categoryIDs.push(option.value);-->
<!--            });-->

<!--            var productDTO = {-->
<!--                product: {-->
<!--                    // Thêm các thuộc tính của product từ form-->
<!--                    name: document.querySelector('input[name="name"]').value,-->
<!--                    original_price: document.querySelector('input[name="original_price"]').value,-->
<!--                    discount: document.querySelector('input[name="discount"]').value,-->
<!--                    description: document.querySelector('input[name="description"]').value,-->
<!--                    details: document.querySelector('input[name="details"]').value,-->
<!--                    delivery: document.querySelector('input[name="delivery"]').value,-->
<!--                    sub_info: document.querySelector('input[name="sub_info"]').value,-->
<!--                    image1: document.querySelector('input[name="image1"]').value,-->
<!--                    image2: document.querySelector('input[name="image2"]').value,-->
<!--                    image3: document.querySelector('input[name="image3"]').value,-->
<!--                    image4: document.querySelector('input[name="image4"]').value,-->
<!--                    image5: document.querySelector('input[name="image5"]').value-->
<!--                },-->
<!--                selectedItems: itemObjects,-->
<!--                categoryIDs: categoryIDs-->
<!--            };-->

<!--            var input = document.createElement('input');-->
<!--            input.type = 'hidden';-->
<!--            input.name = 'productDTO';-->
<!--            input.value = JSON.stringify(productDTO);-->
<!--            this.appendChild(input);-->

<!--            this.submit();-->
<!--        });-->


<!--    </script>-->
<!--    <script>-->
<!--        document.getElementById('product-form').addEventListener('submit', function(event) {-->
<!--            event.preventDefault();-->

<!--            var productDTO = {-->
<!--                product: {-->
<!--                    name: document.querySelector('input[name="name"]').value,-->
<!--                    original_price: document.querySelector('input[name="original_price"]').value,-->
<!--                    discount: document.querySelector('input[name="discount"]').value,-->
<!--                    description: document.querySelector('input[name="description"]').value,-->
<!--                    details: document.querySelector('input[name="details"]').value,-->
<!--                    delivery: document.querySelector('input[name="delivery"]').value,-->
<!--                    sub_info: document.querySelector('input[name="sub_info"]').value,-->
<!--                    image1: document.querySelector('input[name="image1"]').value,-->
<!--                    image2: document.querySelector('input[name="image2"]').value,-->
<!--                    image3: document.querySelector('input[name="image3"]').value,-->
<!--                    image4: document.querySelector('input[name="image4"]').value,-->
<!--                    image5: document.querySelector('input[name="image5"]').value,-->
<!--                },-->
<!--                selectedItems: [{-->
<!--                    id: document.querySelector('select[name="itemIDs"]').value,-->
<!--                    quantity: document.querySelector('input[name="numberFlower"]').value-->
<!--                }],-->
<!--                categoryIDs: Array.from(document.querySelectorAll('select[name="categoryIDs"] option:checked')).map(option => option.value)-->
<!--            };-->

<!--            fetch('/admin/product/add-product', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                },-->
<!--                body: JSON.stringify(productDTO)-->
<!--            })-->
<!--                .then(response => response.json())-->
<!--                .then(data => {-->
<!--                    console.log(data);-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    console.error('Error:', error);-->
<!--                });-->
<!--        });-->

<!--    </script>-->
    <script>
        document.getElementById('product-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // Lấy danh sách các select box
            var selectBoxes = document.querySelectorAll('select[name="itemIDs"]');

            // Tạo mảng để lưu trữ các selectedItems
            var selectedItems = [];

            // Lặp qua mỗi select box
            selectBoxes.forEach(function(selectBox) {
                var id = selectBox.value;
                var quantity = selectBox.closest('tr').querySelector('input[name="numberFlower"]').value;

                // Kiểm tra xem đã chọn id và quantity chưa
                if (id && quantity) {
                    // Tạo đối tượng mới và thêm vào mảng selectedItems
                    var selectedItem = {
                        id: id,
                        quantity: quantity
                    };
                    selectedItems.push(selectedItem);
                }
            });

            // Lấy giá trị categoryIDs từ các option đã chọn
            var categoryIDs = Array.from(document.querySelectorAll('select[name="categoryIDs"] option:checked')).map(option => option.value);

            // Tạo đối tượng productDTO
            var productDTO = {
                product: {
                    name: document.querySelector('input[name="name"]').value,
                    original_price: document.querySelector('input[name="original_price"]').value,
                    discount: document.querySelector('input[name="discount"]').value,
                    description: document.querySelector('input[name="description"]').value,
                    details: document.querySelector('input[name="details"]').value,
                    delivery: document.querySelector('input[name="delivery"]').value,
                    sub_info: document.querySelector('input[name="sub_info"]').value,
                    image1: document.querySelector('input[name="image1"]').value,
                    image2: document.querySelector('input[name="image2"]').value,
                    image3: document.querySelector('input[name="image3"]').value,
                    image4: document.querySelector('input[name="image4"]').value,
                    image5: document.querySelector('input[name="image5"]').value,
                },
                selectedItems: selectedItems,
                categoryIDs: categoryIDs
            };

            // Gửi dữ liệu đến API sử dụng Fetch API hoặc jQuery.ajax
            fetch('/admin/product/add-product', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productDTO)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>

    <script>
        document.getElementById('product-form').addEventListener('submit', function() {
            var selectedItems = [];

            // Lặp qua tất cả các select box
            var selects = document.querySelectorAll('select[name^="flowerTypes"]');
            selects.forEach(function(select) {
                var selectedOption = select.options[select.selectedIndex];
                selectedItems.push(selectedOption.value);
            });

            // Tạo một input ẩn để chứa danh sách các ID item
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'selectedItems';
            input.value = JSON.stringify(selectedItems);

            // Thêm input vào form
            this.appendChild(input);
        });
    </script>
</div>
</body>

</html>